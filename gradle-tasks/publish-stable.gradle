tasks.register("publishStable") {
    doLast {
        def moduleName = project.findProperty("moduleName")

        if (!moduleName) {
            println "‚ùå Error: No module specified. Use `-PmoduleName=<module>` to publish a specific module."
            return
        }

        def targetProject = rootProject.subprojects.find { it.name == moduleName }

        if (!targetProject) {
            println "‚ùå Error: Module '$moduleName' not found."
            return
        }

        def projectVersion = targetProject.version.toString()

        if (projectVersion.contains("-SNAPSHOT")) {
            println "‚è≠Ô∏è Skipping ${targetProject.name}: Snapshot version ($projectVersion)"
            return
        }

        if (targetProject.tasks.named("publishPlugins")) {
            println "üöÄ Running `publishPlugins` for ${targetProject.name} (version: $projectVersion)"
            dependsOn(":${targetProject.name}:publishPlugins")
        } else if (targetProject.tasks.named("publish")) {
            println "üì¶ Running `publish` for ${targetProject.name} (version: $projectVersion)"
            dependsOn(":${targetProject.name}:publish")
        } else {
            println "‚ö†Ô∏è No publish task found for ${targetProject.name}."
        }
    }
}
