// Conditionally set root project version only when publishSnapshots is executed
gradle.taskGraph.whenReady { taskGraph ->
    if (taskGraph.hasTask(":publishSnapshots")) {
        rootProject.version = "1.0.0-SNAPSHOT"
        println "üìå Setting root project version to 1.0.0-SNAPSHOT for publishSnapshots task"
    }
}

tasks.register("publishSnapshots") {
    def snapshotModules = rootProject.subprojects.findAll { project ->
        project.version.toString().contains("-SNAPSHOT") && project.tasks.named("publish") != null
    }

    if (!snapshotModules.isEmpty()) {
        dependsOn snapshotModules.collect { ":${it.name}:publish" }
    }

    doLast {
        if (snapshotModules.isEmpty()) {
            println "‚ùå No snapshot modules to publish."
        } else {
            println "üì¶ Successfully published snapshots for: ${snapshotModules*.name}"
        }
    }
}
