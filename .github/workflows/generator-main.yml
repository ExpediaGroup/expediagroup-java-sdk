name: Generate SDK - Main
on:
  workflow_dispatch:
    inputs:
      name:
        description: 'SDK Name'
        required: true
      client:
        description: 'Client Name (SDK Name will be used if not provided)'
        required: false
        default: ''
      version:
        description: 'SDK Version'
        required: false
        default: ''
      specs_url:
        description: 'URL to download API specs from'
        required: true
        type: string
      snapshot:
        description: 'Release a Snapshot? (Leave blank for no, anything else for yes)'
        required: false
        default: 'yes'

env:
  CLIENT: ${{ github.event.inputs.client }} || ${{ github.event.inputs.name }}

jobs:
  prepare_version:
    uses: ./.github/workflows/generator-prepare-version.yml
    with:
      name: ${{ github.event.inputs.name }}
      version: ${{ github.event.inputs.version }}
  download_specs:
    uses: ./.github/workflows/generator-download-specs.yml
    with:
      url: ${{ github.event.inputs.specs_url }}
  transform_specs:
    needs: [ download_specs ]
    uses: ./.github/workflows/generator-transform-specs.yml
    with:
      configurations: -th -te -tt $CLIENT
  generate:
    needs: [ prepare_version, transform_specs ]
    uses: ./.github/workflows/generator-generate.yml
    with:
      name: ${{ github.event.inputs.name }}
      version: ${{ needs.prepare_version.outputs.version }}
  publish_sources:
    needs: [ generate ]
    uses: ./.github/workflows/generator-publish-sources.yml
    with:
      name: ${{ github.event.inputs.name }}
      version: ${{ github.event.inputs.version }}
      snapshot: ${{ github.event.inputs.snapshot }}
  publish_artifact:
    needs: [ publish_sources ]
    uses: ./.github/workflows/generator-publish-artifact.yml
    secrets: inherit
    with:
      snapshot: ${{ github.event.inputs.snapshot }}
