package com.expediagroup.sdk.{{{namespace}}}.test;

import com.fasterxml.jackson.module.kotlin.*
import com.fasterxml.jackson.databind.node.ObjectNode
import com.google.common.io.Resources
import java.io.File;
import com.github.rvesse.airline.annotations.Command;

@Command(name = "cli", description = "Command Line Interface for SDK Test")
class Main {
    companion object {
        @JvmStatic
        val mapper = jacksonObjectMapper()

        @JvmStatic
        val executor = {{{clientClassname}}}Executor()

        @JvmStatic
        fun main(args: Array<String>) {
            Main().run()
        }
    }

    fun run() {
        File(Resources.getResource("contract-tests")!!.file).listFiles()!!.forEach { file ->
            mapper.readTree(file).let { test ->
                val request = test["request"] as ObjectNode
                val response = test["response"] as ObjectNode

                executor.execute(request, response)
            }
        }
    }
}
